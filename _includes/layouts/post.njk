---
layout: layouts/base.njk
author: "{{ author or 'default' }}"
---

{# Only include the syntax highlighter CSS on blog posts, included with the CSS
per-page bundle #}
<style>
	{% include "node_modules/prismjs/themes/prism-okaidia.css" %}
</style>
<style>
	{% include "css/prism-diff.css" %}
</style>

{# Auto-switch to post author's theme #}
<script eleventy:ignore>
document.addEventListener('DOMContentLoaded', function() {
	const postAuthor = '{{ author }}';
	const validAuthors = ['jane', 'orionlw', 'adesse', 'nic', 'amelia', 'abby', 'ewan'];

	if (postAuthor && validAuthors.includes(postAuthor)) {
		// Set author theme
		document.documentElement.setAttribute('data-author', postAuthor);
		document.body.setAttribute('data-author', postAuthor);

		// Update author selector dropdowns to match
		const authorSelectors = document.querySelectorAll('.author-sync');
		authorSelectors.forEach(function(sel) {
			sel.value = postAuthor;
		});

		// Save preference
		try {
			localStorage.setItem('author-theme', postAuthor);
		} catch(e) {
			console.warn('Could not save author preference:', e);
		}

		console.log('Auto-switched to', postAuthor, 'theme for blog post');
	}
});
</script>

<article class="h-entry">
	<h1 class="post-title p-name">{{ title }}</h1>
	<div class="post-meta">
		<time class="dt-published" datetime="{{ page.date | htmlDateString }}">
			{% set parsedDate = page.date | parseCMSDate %}
			{% if parsedDate %}
				{{ parsedDate | readableDate }}
			{% endif %}
		</time>

		{# Main author #}
		{%- if author -%}
		<span class="post-author" style="margin-left: 1em">
			by
			<a href="/authors/{{ author }}/" class="h-card p-author">{{
				authors[author].name or author
			}}</a>
		</span>
		{%- endif -%}

		{# Collaborators #}
		{%- if collaborators and collaborators.length -%}
		<span class="post-collaborators" style="margin-left: 0.5em">
			with
			{%- for collaborator in collaborators %}
				<a href="/authors/{{ collaborator }}/" class="h-card">{{ authors[collaborator].name or collaborator }}</a>{% if not loop.last %}, {% endif %}
			{%- endfor %}
		</span>
		{%- endif -%}

		{# Reading time #}
		{%- if content %}
		<span class="post-reading-time" style="margin-left: 1em; color: var(--color-text-secondary, #666);">
			{{ content | wordCount }} words ‚Ä¢ {{ (content | wordCount / 200) | round }} min read
		</span>
		{%- endif -%}
	</div>

	{# Series information #}
	{%- if series -%}
	<div class="post-series" style="margin: 1rem 0; padding: 1rem; background: var(--color-bg-secondary, #f8f9fa); border-left: 4px solid var(--color-primary, #007bff); border-radius: 0.25rem;">
		<h4 style="margin: 0 0 0.5rem 0; font-size: 0.9rem; color: var(--color-text-secondary, #666); text-transform: uppercase; letter-spacing: 0.05em;">
			üìö Part of a Series
		</h4>
		<p style="margin: 0; font-weight: 600;">
			{{ series }}
			{%- if seriesPart %} - Part {{ seriesPart }}{% endif %}
		</p>
		{# TODO: Add links to other parts of the series #}
	</div>
	{%- endif -%}

	{%- if tags and tags.length -%}
	{%- set uniqueTags = tags | unique -%}
	<div class="post-tags" style="margin: 0.5em 0;">
		<span>Tags:</span>
		{%- for tag in uniqueTags %}
			{% if tag == "posts" %}
				<a href="/explore/" class="post-tag">posts</a>{% if not loop.last %}, {% endif %}
			{% else %}
				<a href="/tags/{{ tag | slugify }}/" class="post-tag">{{ tag }}</a>{% if not loop.last %}, {% endif %}
			{% endif %}
		{%- endfor %}
	</div>
	{%- endif -%}

	<div class="e-content">
		{{ content | safe }}
	</div>

	{# Cross-author recommendations #}
	{%- if collections.posts %}
	{%- set crossAuthorRecs = collections.posts | crossAuthorRecommendations(page) %}
	{%- if crossAuthorRecs and crossAuthorRecs.length > 0 %}
	<div class="cross-author-recommendations" style="margin: 3rem 0 2rem 0; padding: 2rem; background: var(--color-bg-secondary, #f8f9fa); border: 1px solid var(--color-border, #e9ecef); border-radius: 0.5rem;">
		<h3 style="margin: 0 0 1.5rem 0; font-size: 1.2rem; color: var(--color-text-primary, #333);">
			<span style="margin-right: 0.5rem;" aria-hidden="true">üîç</span>
			Discover Other Authors
		</h3>
		<div class="cross-author-grid" style="display: grid; gap: 1.5rem;">
			{%- for post in crossAuthorRecs %}
			<article class="cross-author-post" style="display: flex; gap: 1rem; padding: 1rem; background: white; border-radius: 0.375rem; border: 1px solid var(--color-border, #e9ecef);" data-author="{{ post.data.author }}">
				<div class="author-avatar" style="flex-shrink: 0;">
					<a href="/authors/{{ post.data.author }}/" style="display: block; width: 48px; height: 48px; border-radius: 50%; background: var(--{{ post.data.author }}-primary, #007bff); display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; font-weight: bold; font-size: 1.2rem;">
						{{ (authors[post.data.author].name or post.data.author) | slice(0, 1) | upper }}
					</a>
				</div>
				<div class="post-info" style="flex: 1; min-width: 0;">
					<h4 style="margin: 0 0 0.25rem 0; font-size: 1rem;">
						<a href="{{ post.url }}" style="color: var(--color-text-primary, #333); text-decoration: none;">{{ post.data.title }}</a>
					</h4>
					<p style="margin: 0 0 0.5rem 0; font-size: 0.875rem; color: var(--color-text-secondary, #666);">
						by <a href="/authors/{{ post.data.author }}/" style="color: var(--{{ post.data.author }}-primary, #007bff); text-decoration: none; font-weight: 500;">{{ authors[post.data.author].name or post.data.author }}</a>
						‚Ä¢ {{ post.data.date | readableDate }}
					</p>
					{%- if post.data.excerpt %}
					<p style="margin: 0; font-size: 0.875rem; color: var(--color-text-primary, #333); line-height: 1.4;">
						{{ post.data.excerpt | truncate(120) }}
					</p>
					{%- endif %}
				</div>
			</article>
			{%- endfor %}
		</div>
	</div>
	{%- endif %}
	{%- endif %}

	{# Social sharing #}
	<div data-social-share></div>

	{# Webmentions #}
	{% set webmentionsUrl = page.url %}
	{% include "webmentions.njk" %}

	{%- if author and collections.posts %}
	{%- set authorPosts = collections.posts | filterByAuthor(author) | reverse %}
	{%- set currentIndex = -1 %}
	{%- for post in authorPosts %}
		{%- if post.url == page.url %}
			{%- set currentIndex = loop.index0 %}
		{%- endif %}
	{%- endfor %}

	{%- if currentIndex >= 0 and authorPosts.length > 1 %}
	<div style="margin: 3rem 0 2rem 0; padding: 1.5rem; border: 2px solid var(--primary); border-radius: 8px; background: var(--background-color);">
		<h3 style="margin: 0 0 1rem 0; font-size: 1.2rem;">More from {{ authors[author].name }}</h3>
		<ul class="links-nextprev">
			{%- set nextAuthorPost = authorPosts[currentIndex - 1] %}
			{%- if nextAuthorPost %}
			<li class="links-nextprev-next">
				<strong>Next by {{ authors[author].name }}</strong>:
				<a href="{{ nextAuthorPost.url }}">{{ nextAuthorPost.data.title }}</a>
			</li>
			{%- endif %}

			{%- set prevAuthorPost = authorPosts[currentIndex + 1] %}
			{%- if prevAuthorPost %}
			<li class="links-nextprev-previous">
				<strong>Previous by {{ authors[author].name }}</strong>:
				<a href="{{ prevAuthorPost.url }}">{{ prevAuthorPost.data.title }}</a>
			</li>
			{%- endif %}
		</ul>
	</div>
	{%- endif %}
	{%- endif %}

	{%- if collections.posts %}
	<div style="margin: 2rem 0; padding: 1.5rem; border: 2px solid var(--primary); border-radius: 8px; background: var(--background-color);">
		<h3 style="margin: 0 0 1rem 0; font-size: 1.2rem;">Navigate All Posts</h3>
		<ul class="links-nextprev">
			{%- set nextPost = collections.posts | getNextCollectionItem(page) %}
			{%- if nextPost %}
			<li class="links-nextprev-next">
				<strong>Next</strong>:
				<a href="{{ nextPost.url }}">{{ nextPost.data.title }}</a>
			</li>
			{%- endif %}

			{%- set previousPost = collections.posts | getPreviousCollectionItem(page) %}
			{%- if previousPost %}
			<li class="links-nextprev-previous">
				<strong>Previous</strong>:
				<a href="{{ previousPost.url }}">{{ previousPost.data.title }}</a>
			</li>
			{%- endif %}
		</ul>
	</div>
	{%- endif %}
</article>
