---
layout: layouts/base.njk
author: "{{ author or 'default' }}"
---

{# Only include the syntax highlighter CSS on blog posts, included with the CSS
per-page bundle #}
<style>
	{% include "node_modules/prismjs/themes/prism-okaidia.css" %}
</style>
<style>
	{% include "css/prism-diff.css" %}
</style>

{# Auto-switch to post author's theme #}
<script eleventy:ignore>
document.addEventListener('DOMContentLoaded', function() {
	const postAuthor = '{{ author }}';
	const validAuthors = ['jane', 'orionlw', 'adesse', 'nic', 'amelia', 'abby', 'ewan'];

	if (postAuthor && validAuthors.includes(postAuthor)) {
		// Set author theme
		document.documentElement.setAttribute('data-author', postAuthor);
		document.body.setAttribute('data-author', postAuthor);

		// Update author selector dropdowns to match
		const authorSelectors = document.querySelectorAll('.author-sync');
		authorSelectors.forEach(function(sel) {
			sel.value = postAuthor;
		});

		// Save preference
		try {
			localStorage.setItem('author-theme', postAuthor);
		} catch(e) {
			console.warn('Could not save author preference:', e);
		}

		console.log('Auto-switched to', postAuthor, 'theme for blog post');
	}
});
</script>

<article class="h-entry">
	<h1 class="post-title p-name">{{ title }}</h1>
	<div class="post-meta">
		<time class="dt-published" datetime="{{ page.date | htmlDateString }}">
			{% set parsedDate = page.date | parseCMSDate %}
			{% if parsedDate %}
				{{ parsedDate | readableDate }}
			{% endif %}
		</time>
		{%- if author -%}
		<span class="post-author" style="margin-left: 1em">
			by
			<a href="/authors/{{ author }}/" class="h-card p-author">{{
				author
			}}</a>
		</span>
		{%- endif -%}
	</div>

	{%- if tags and tags.length -%}
	{%- set uniqueTags = tags | unique -%}
	<div class="post-tags" style="margin: 0.5em 0;">
		<span>Tags:</span>
		{%- for tag in uniqueTags %}
			{% if tag == "posts" %}
				<a href="/explore/" class="post-tag">posts</a>{% if not loop.last %}, {% endif %}
			{% else %}
				<a href="/tags/{{ tag | slugify }}/" class="post-tag">{{ tag }}</a>{% if not loop.last %}, {% endif %}
			{% endif %}
		{%- endfor %}
	</div>
	{%- endif -%}

	<div class="e-content">
		{{ content | safe }}
	</div>

{% set webmentionsUrl = page.url %}
{% include "webmentions.njk" %}

	{%- if author and collections.posts %}
	{%- set authorPosts = collections.posts | filterByAuthor(author) | reverse %}
	{%- set currentIndex = -1 %}
	{%- for post in authorPosts %}
		{%- if post.url == page.url %}
			{%- set currentIndex = loop.index0 %}
		{%- endif %}
	{%- endfor %}

	{%- if currentIndex >= 0 and authorPosts.length > 1 %}
	<div style="margin: 3rem 0 2rem 0; padding: 1.5rem; border: 2px solid var(--primary); border-radius: 8px; background: var(--background-color);">
		<h3 style="margin: 0 0 1rem 0; font-size: 1.2rem;">More from {{ authors[author].name }}</h3>
		<ul class="links-nextprev">
			{%- set nextAuthorPost = authorPosts[currentIndex - 1] %}
			{%- if nextAuthorPost %}
			<li class="links-nextprev-next">
				<strong>Next by {{ authors[author].name }}</strong>:
				<a href="{{ nextAuthorPost.url }}">{{ nextAuthorPost.data.title }}</a>
			</li>
			{%- endif %}

			{%- set prevAuthorPost = authorPosts[currentIndex + 1] %}
			{%- if prevAuthorPost %}
			<li class="links-nextprev-previous">
				<strong>Previous by {{ authors[author].name }}</strong>:
				<a href="{{ prevAuthorPost.url }}">{{ prevAuthorPost.data.title }}</a>
			</li>
			{%- endif %}
		</ul>
	</div>
	{%- endif %}
	{%- endif %}

	{%- if collections.posts %}
	<div style="margin: 2rem 0; padding: 1.5rem; border: 2px solid var(--primary); border-radius: 8px; background: var(--background-color);">
		<h3 style="margin: 0 0 1rem 0; font-size: 1.2rem;">Navigate All Posts</h3>
		<ul class="links-nextprev">
			{%- set nextPost = collections.posts | getNextCollectionItem(page) %}
			{%- if nextPost %}
			<li class="links-nextprev-next">
				<strong>Next</strong>:
				<a href="{{ nextPost.url }}">{{ nextPost.data.title }}</a>
			</li>
			{%- endif %}

			{%- set previousPost = collections.posts | getPreviousCollectionItem(page) %}
			{%- if previousPost %}
			<li class="links-nextprev-previous">
				<strong>Previous</strong>:
				<a href="{{ previousPost.url }}">{{ previousPost.data.title }}</a>
			</li>
			{%- endif %}
		</ul>
	</div>
	{%- endif %}
</article>
